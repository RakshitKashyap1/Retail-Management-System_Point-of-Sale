{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RMS POS{% endblock %}</title>
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
    <link href="{% static 'css/purple_theme.css' %}" rel="stylesheet">
    <script>
        // Check for saved theme preference or use system preference
        const savedTheme = localStorage.getItem('theme') || 'dark';
        if (savedTheme === 'light') {
            document.documentElement.classList.add('light-theme');
        }
    </script>
</head>

<body>
    {% if user.is_authenticated %}
    <nav>
        <div class="nav-container">
            <div style="display: flex; align-items: center; gap: 2rem;">
                <h1 class="nav-brand">RMS POS</h1>
                <div class="nav-links">
                    <a href="{% url 'inventory_dashboard' %}" class="nav-link">Dashboard</a>
                    <a href="{% url 'product_list' %}" class="nav-link">Products</a>
                    <a href="{% url 'pos_dashboard' %}" class="nav-link">POS</a>
                    <a href="{% url 'sales_list' %}" class="nav-link">Sales</a>
                </div>
            </div>
            <div class="nav-user">
                <button id="theme-toggle" type="button" class="btn btn-secondary"
                    style="padding: 0.5rem; display: flex; align-items: center; justify-content: center;"
                    aria-label="Toggle theme">
                    <!-- Sun Icon -->
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" style="display: none;">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <!-- Moon Icon -->
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                <div style="display: flex; flex-direction: column; line-height: 1.2;">
                    <span style="font-size: 0.8rem; color: var(--text-secondary);">Welcome back,</span>
                    <span style="font-weight: 600; color: var(--text-primary);">{{ user.username }}</span>
                </div>
                <form method="post" action="{% url 'logout' %}" style="margin: 0;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-secondary">Logout</button>
                </form>
            </div>
        </div>
    </nav>
    {% endif %}

    <main class="container" style="padding-top: 2rem; padding-bottom: 2rem; min-height: calc(100vh - 12rem);">
        {% if messages %}
        {% for message in messages %}
        <div class="message {% if message.tags == 'error' %}message-error{% else %}message-success{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% block content %}{% endblock %}
    </main>

    <footer>
        <div class="container">
            <p class="footer-text">&copy; {% now "Y" %} Retail Management System. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const themeToggle = document.getElementById('theme-toggle');

            if (!themeToggle) return;

            const sunIcon = themeToggle.querySelector('.sun-icon');
            const moonIcon = themeToggle.querySelector('.moon-icon');

            function updateIcons(isLight) {
                if (isLight) {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'block';
                } else {
                    sunIcon.style.display = 'block';
                    moonIcon.style.display = 'none';
                }
            }

            // Sync with current class state
            const isLight = document.documentElement.classList.contains('light-theme');
            updateIcons(isLight);

            themeToggle.addEventListener('click', function () {
                // Toggle Class
                document.documentElement.classList.toggle('light-theme');

                // Check new state
                const isNowLight = document.documentElement.classList.contains('light-theme');

                // Save preference
                localStorage.setItem('theme', isNowLight ? 'light' : 'dark');

                // Update UI
                updateIcons(isNowLight);
                console.log('Theme toggled to:', isNowLight ? 'light' : 'dark');
            });
        });
    </script>
</body>

</html>